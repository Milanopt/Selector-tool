<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Speaker Selector</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:system-ui, sans-serif;padding:1rem;background:#f9fafb;color:#111;line-height:1.4}
    h1{font-size:1.8rem;margin-bottom:1rem}
    label{font-size:.9rem;font-weight:600;margin-right:.25rem}
    input,select{padding:.25rem .5rem;border:1px solid #ccc;border-radius:4px;font-size:.9rem}
    .filters{display:flex;flex-wrap:wrap;gap:1rem;margin-bottom:1rem}
    table{width:100%;border-collapse:collapse;background:#fff;border-radius:.5rem;overflow:hidden;box-shadow:0 1px 4px rgba(0,0,0,.08)}
    th,td{padding:.5rem .75rem;text-align:left;border-bottom:1px solid #eee;font-size:.85rem}
    th{background:#f1f5f9;text-transform:uppercase;font-size:.75rem;letter-spacing:.02em}
    tr:last-child td{border-bottom:none}
    @media(max-width:700px){table,thead,tbody,th,td,tr{display:block}thead{display:none}td{border:none;position:relative;padding-left:50%}td::before{content:attr(data-label);position:absolute;left:0;width:45%;padding-left:.75rem;font-weight:600;background:#f1f5f9;height:100%;top:0}}
  </style>
</head>
<body>
<h1>Speaker Selector</h1>

<div class="filters">
  <div>
    <label for="search">Search</label>
    <input id="search" type="text" placeholder="brand or model" />
  </div>
  <div>
    <label for="mount">Mount</label>
    <select id="mount">
      <option value="">Any</option>
      <option value="surface mount">Surface</option>
      <option value="ceiling mount">Ceiling</option>
      <option value="pendant">Pendant</option>
    </select>
  </div>
  <div>
    <label for="minPower">Min RMS W</label>
    <input id="minPower" type="number" min="0" step="5" style="width:6rem" />
  </div>
  <div>
    <label for="maxPower">Max RMS W</label>
    <input id="maxPower" type="number" min="0" step="5" style="width:6rem" />
  </div>
  <div>
    <label for="imp">Impedance Î©</label>
    <select id="imp">
      <option value="">Any</option>
      <option value="4">4 Î©</option>
      <option value="6">6 Î©</option>
      <option value="8">8 Î©</option>
      <option value="16">16 Î©</option>
    </select>
  </div>
  <div style="display:flex;align-items:center;gap:.25rem">
    <input id="weather" type="checkbox" />
    <label for="weather">Weatherproof</label>
  </div>
  <div style="display:flex;align-items:center;gap:.25rem">
    <input id="has100v" type="checkbox" />
    <label for="has100v">100Â V taps</label>
  </div>
</div>

<table id="results">
  <thead>
    <tr>
      <th>Brand</th><th>Model</th><th>Mount</th><th>RMSÂ W</th><th>Î©</th><th>SensÂ dB</th><th>MaxÂ SPLÂ dB</th><th>DispÂ HÃ—VÂ°</th><th>Driver</th><th>DimsÂ mm (WÃ—HÃ—D)</th><th>WP</th><th>100Â V</th><th>TapÂ W</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
// ------------------------------------------------------------
// Dynamic JSON discovery without hardâ€‘coding filenames
// ------------------------------------------------------------
// 1. For GitHub Pages / any public GitHub repo
//    we can call the GitHub REST API to list directory contents.
// 2. When running locally via "file://" or a simple local web server
//    we fall back to a small static list so you can still test offline.
//
// ðŸ‘‰ Replace these placeholders with your GitHub details
const GH_OWNER = "YOUR_GH_USERNAME";   // e.g. "acme-corp"
const GH_REPO  = "YOUR_REPO_NAME";     // e.g. "speaker-selector"
const DATA_DIR = "";                   // path inside the repo where JSON lives, "" == repo root
const BRANCH   = "main";               // or "gh-pages" / "master"

let products = [];

async function listJsonFilesFromGitHub() {
  const apiUrl = `https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/contents/${DATA_DIR}?ref=${BRANCH}`;
  const res = await fetch(apiUrl);
  if (!res.ok) throw new Error("GitHub API error: " + res.status);
  const items = await res.json(); // array of {name, download_url, type}
  return items
    .filter(it => it.type === "file" && it.name.toLowerCase().endsWith(".json"))
    .map(it => it.download_url); // raw.githubusercontent URLs
}

// Fallback list for local testing (edit if you add files)
const fallbackFiles = [
  "audac-ateo6m-8ohm.json",
  "audac-ateo6dm-16ohm.json"
];

async function loadProducts() {
  try {
    let urls;
    if (location.protocol.startsWith("http") && location.hostname !== "localhost") {
      // Hosted via HTTP(S) and not local dev â‡’ try GitHub API
      urls = await listJsonFilesFromGitHub();
    } else {
      // Local filesystem or local server â‡’ use fallback list in same folder
      urls = fallbackFiles.map(f => f);
    }

    const responses = await Promise.all(urls.map(u => fetch(u)));
    const jsonArrays = await Promise.all(responses.map(r => {
      if (!r.ok) throw new Error(`Failed to fetch ${r.url}`);
      return r.json();
    }));
    products = jsonArrays.flat();
    applyFilters();
  } catch (err) {
    console.error("Error loading products:", err);
    document.querySelector('#results tbody').innerHTML = `<tr><td colspan="13">Failed to load product data.<br>${err.message}</td></tr>`;
  }
}

document.addEventListener('DOMContentLoaded', loadProducts);

// ---------- Filtering UI ----------
const tbody = document.querySelector('#results tbody');
const mounts = document.getElementById('mount');
const minP = document.getElementById('minPower');
const maxP = document.getElementById('maxPower');
const imp = document.getElementById('imp');
const wp = document.getElementById('weather');
const line100 = document.getElementById('has100v');
const search = document.getElementById('search');

[ mounts, minP, maxP, imp, wp, line100, search].forEach(el => el.addEventListener('input', applyFilters));

function applyFilters(){
  const term = search.value.toLowerCase();
  const data = products.filter(p => {
    if (term && !(p.brand+" "+p.model).toLowerCase().includes(term)) return false;
    if (mounts.value && p.mount_type!==mounts.value) return false;
    if (imp.value && p.impedance_ohm.toString()!==imp.value) return false;
    if (minP.value && p.rms_power_w < parseFloat(minP.value)) return false;
    if (maxP.value && p.rms_power_w > parseFloat(maxP.value)) return false;
    if (wp.checked && !p.weatherproof) return false;
    if (line100.checked && !p.has_100v_taps) return false;
    return true;
  });
  renderTable(data);
}

function renderTable(rows){
  tbody.innerHTML = rows.map(r => {
    const disp = `${r.dispersion_deg.horizontal}Ã—${r.dispersion_deg.vertical}`;
    const dims = `${r.dimensions_mm.width}Ã—${r.dimensions_mm.height}Ã—${r.dimensions_mm.depth}`;
    return `<tr>
      <td data-label="Brand">${r.brand}</td>
      <td data-label="Model">${r.model}</td>
      <td data-label="Mount">${r.mount_type}</td>
      <td data-label="RMS W">${r.rms_power_w}</td>
      <td data-label="Î©">${r.impedance_ohm}</td>
      <td data-label="Sens dB">${r.sensitivity_db_1w1m}</td>
      <td data-label="Max SPL">${r.max_spl_db}</td>
      <td data-label="Disp">${disp}</td>
      <td data-label="Driver">${r.driver_configuration}</td>
      <td data-label="Dims">${dims}</td>
      <td data-label="WP">${r.weatherproof?"âœ”":""}</td>
      <td data-label="100V">${r.has_100v_taps?"âœ”":""}</td>
      <td data-label="Tap W">${r.max_tap_w_100v??""}</td>
    </tr>`;
  }).join("");
  if (!rows.length) tbody.innerHTML = '<tr><td colspan="13">No matches</td></tr>';
}
</script>
</body>
</html>
